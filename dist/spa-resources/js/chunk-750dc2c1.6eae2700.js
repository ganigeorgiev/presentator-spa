(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-750dc2c1"],{"0372":function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return e.activeScreen?t("div",{directives:[{name:"shortcut",rawName:"v-shortcut.37",value:e.goToPrevScreen,expression:"goToPrevScreen",modifiers:{37:!0}},{name:"shortcut",rawName:"v-shortcut.39",value:e.goToNextScreen,expression:"goToNextScreen",modifiers:{39:!0}}],staticClass:"preview-screen-holder",class:[e.activePrototype.isForDesktop?"desktop":"mobile","align-"+e.activeScreen.alignment,e.inTransition?"transitioning":"",e.overlayScreen?"overlay-active":"","transition-"+e.activeTransition]},[e.screens.length>1?[t("nav",{staticClass:"preview-nav nav-left",class:{"nav-disabled":0==e.activeScreenOrderedIndex},attrs:{title:e.$t("Prev screen")},on:{click:function(t){return t.preventDefault(),e.goToPrevScreen()}}},[t("i",{staticClass:"fe fe-chevron-left"})]),t("nav",{staticClass:"preview-nav nav-right",class:{"nav-disabled":e.orderedScreens.length==e.activeScreenOrderedIndex+1},attrs:{title:e.$t("Next screen")},on:{click:function(t){return t.preventDefault(),e.goToNextScreen()}}},[t("i",{staticClass:"fe fe-chevron-right"})])]:e._e(),t("div",{ref:"activeScreenWrapper",staticClass:"screen-wrapper",style:{width:e.activePrototype.width?e.activePrototype.width+"px":null,height:e.activePrototype.height?e.activePrototype.height+"px":null,background:e.activeScreen.background||null},attrs:{tabindex:"-1"},on:{"&!scroll":function(t){return e.fixedOverlayReposition.apply(null,arguments)}}},[e.interactions&&e.activeScreen.fixedHeader>0?t("div",{staticClass:"fixed-screen-header",style:{height:e.activeScreen.fixedHeader*e.scaleFactor+"px","margin-top":-e.activeScreen.fixedHeader*e.scaleFactor+"px"}},[t("div",{staticClass:"fixed-screen-overflow-wrapper"},[t("div",{staticClass:"fixed-screen-content-wrapper"},[t("img",{directives:[{name:"scale",rawName:"v-scale",value:e.scaleFactor,expression:"scaleFactor"}],staticClass:"fixed-screen",attrs:{crossorigin:"anonymous",src:e.activeScreen.getImage(),alt:e.activeScreen.title}}),t("div",{staticClass:"block preview-hotspots-block"},e._l(e.activeScreenHotspots,(function(s){return s.top<e.activeScreen.fixedHeader?t("div",{key:"fixed_header_hotspot_"+s.id,staticClass:"hotspot",style:{left:s.left*e.scaleFactor+"px",top:s.top*e.scaleFactor+"px",width:s.width*e.scaleFactor+"px",height:s.height*e.scaleFactor+"px"},on:{click:function(t){return t.preventDefault(),e.hotspotNavigate(s.id)}}}):e._e()})),0)])])]):e._e(),t("div",{staticClass:"screen-inner-wrapper",class:{"position-static":e.overlayScreen&&e.isOverlayScreenFixed}},[t("img",{directives:[{name:"show",rawName:"v-show",value:e.oldActiveScreen&&e.inTransition,expression:"oldActiveScreen && inTransition"},{name:"scale",rawName:"v-scale",value:e.screenScaleFactor,expression:"screenScaleFactor"}],staticClass:"screen old-active-screen",style:{background:e.oldActiveScreen?e.oldActiveScreen.background:null},attrs:{crossorigin:"anonymous",src:e.oldActiveScreen?e.oldActiveScreen.getImage():"",alt:e.oldActiveScreen?e.oldActiveScreen.title:""}}),t("img",{directives:[{name:"tooltip",rawName:"v-tooltip.follow",value:e.activeScreenTooltip,expression:"activeScreenTooltip",modifiers:{follow:!0}},{name:"scale",rawName:"v-scale",value:e.screenScaleFactor,expression:"screenScaleFactor"}],key:"active_screen_"+e.activeScreen.id,ref:"activeScreen",staticClass:"screen",class:e.inTransition?"new-active-screen":"current-active-screen",attrs:{crossorigin:"anonymous",draggable:"false",src:e.activeScreen.getImage(),alt:e.activeScreen.title},on:{load:function(t){return e.refreshActiveScreenWrapperAlignment()},mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:(t.stopPropagation(),t.preventDefault(),e.$emit("activeScreenMousedown",t))},click:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:(t.stopPropagation(),t.preventDefault(),e.$emit("activeScreenClick",t))},e.onOverlayOutsideClick]}}),e.interactions&&e.overlayScreen?t("div",{key:"overlayContainer",ref:"overlayContainer",staticClass:"overlay-container",class:e.isOverlayScreenFixed?"fixed":"relative"},[t("div",{staticClass:"overlay-screen-wrapper",class:["transition-"+e.overlayScreenTransition,"position-"+e.overlayScreenPosition,e.isOverlayScreenClosing?"closing":""],style:{"margin-top":e.overlayScreenOffsetTop*e.scaleFactor+"px","margin-bottom":e.overlayScreenOffsetBottom*e.scaleFactor+"px","margin-left":e.overlayScreenOffsetLeft*e.scaleFactor+"px","margin-right":e.overlayScreenOffsetRight*e.scaleFactor+"px"}},[t("img",{directives:[{name:"scale",rawName:"v-scale",value:e.scaleFactor,expression:"scaleFactor"}],staticClass:"screen overlay-screen",attrs:{crossorigin:"anonymous",src:e.overlayScreen.getImage(),alt:e.overlayScreen.title}}),t("div",{key:"overlay-screen-hotspots-block",staticClass:"block preview-hotspots-block"},e._l(e.overlayScreenHotspots,(function(s){return t("div",{key:"overlay_screen_hotspot_"+s.id,staticClass:"hotspot",style:{left:s.left*e.scaleFactor+"px",top:s.top*e.scaleFactor+"px",width:s.width*e.scaleFactor+"px",height:s.height*e.scaleFactor+"px"},on:{click:function(t){return t.preventDefault(),e.hotspotNavigate(s.id)}}})})),0)])]):e._e(),e.interactions?t("div",{key:"active-screen-hotspots-block",staticClass:"block preview-hotspots-block"},e._l(e.activeScreenHotspots,(function(s){return t("div",{key:"active_screen_hotspot_"+s.id,staticClass:"hotspot",style:{left:s.left*e.scaleFactor+"px",top:s.top*e.scaleFactor+"px",width:s.width*e.scaleFactor+"px",height:s.height*e.scaleFactor+"px"},on:{click:function(t){return t.preventDefault(),e.hotspotNavigate(s.id)}}})})),0):e._e(),e._t("default")],2),e.interactions&&e.activeScreen.fixedFooter>0?t("div",{staticClass:"fixed-screen-footer",style:{height:e.activeScreen.fixedFooter*e.scaleFactor+"px","margin-top":-e.activeScreen.fixedFooter*e.scaleFactor+"px"}},[t("div",{staticClass:"fixed-screen-overflow-wrapper"},[t("div",{staticClass:"fixed-screen-content-wrapper"},[t("img",{directives:[{name:"scale",rawName:"v-scale",value:e.scaleFactor,expression:"scaleFactor"}],staticClass:"fixed-screen",attrs:{crossorigin:"anonymous",src:e.activeScreen.getImage(),alt:e.activeScreen.title}}),t("div",{staticClass:"block preview-hotspots-block"},e._l(e.activeScreenHotspots,(function(s){return t("div",{key:"fixed_footer_hotspot_"+s.id,staticClass:"hotspot",style:{left:s.left*e.scaleFactor+"px",top:s.top*e.scaleFactor+"px",width:s.width*e.scaleFactor+"px",height:s.height*e.scaleFactor+"px"},on:{click:function(t){return t.preventDefault(),e.hotspotNavigate(s.id)}}})})),0)])])]):e._e()])],2):e._e()},r=[],o=(s("ac6a"),s("ade3")),n=s("2f62"),a=s("dd93");function c(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function l(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?c(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const m=400;let d=null;var h={name:"screen-preview",props:{interactions:{type:Boolean,default:!0},activeScreenTooltip:{type:String,default:""},fitToScreen:{type:Boolean,default:!1}},data(){return{oldActiveScreenId:null,activeTransition:"none",inTransition:!1,overlayScreenId:null,overlayScreenPosition:"centered",overlayScreenTransition:"none",overlayScreenOffsetTop:0,overlayScreenOffsetBottom:0,overlayScreenOffsetLeft:0,overlayScreenOffsetRight:0,overlayScreenOutsideClose:!0,isOverlayScreenFixed:!1,isOverlayScreenClosing:!1}},computed:l(l(l({},Object(n["d"])({activeScreenId:e=>e.screens.activeScreenId,screens:e=>e.screens.screens,scaleFactor:e=>e.screens.scaleFactor,hotspots:e=>e.hotspots.hotspots,hotspotTemplates:e=>e.hotspots.hotspotTemplates})),Object(n["c"])({activePrototype:"prototypes/activePrototype",getScreen:"screens/getScreen",activeScreen:"screens/activeScreen",orderedScreens:"screens/orderedScreens",activeScreenOrderedIndex:"screens/activeScreenOrderedIndex",getHotspot:"hotspots/getHotspot",getHotspotTemplate:"hotspots/getHotspotTemplate",getHotspotsForScreen:"hotspots/getHotspotsForScreen"})),{},{screenScaleFactor(e,t){return this.fitToScreen?0:this.activePrototype.scaleFactor},oldActiveScreen(){return this.getScreen(this.oldActiveScreenId)},overlayScreen(){return this.getScreen(this.overlayScreenId)},activeScreenHotspots(){return this.getHotspotsForScreen(this.activeScreenId)},overlayScreenHotspots(){return this.getHotspotsForScreen(this.overlayScreenId)}}),watch:{interactions(e,t){this.closeOverlayScreen()},activeScreenId(e,t){this.oldActiveScreenId=t,this.onActiveScreenChange()},"activeScreen.title":function(e,t){e!==t&&this.refreshDocumentTitle()},"activeScreen.alignment":function(e,t){e!==t&&this.refreshActiveScreenWrapperAlignment()},fitToScreen(e,t){this.onActiveScreenChange()}},mounted(){this.onActiveScreenChange(),window.addEventListener("resize",this.onResize,{passive:!0})},beforeDestroy(){window.removeEventListener("resize",this.onResize,{passive:!0})},methods:l(l({},Object(n["b"])({setActiveScreenId:"screens/setActiveScreenId",setScreens:"screens/setScreens",setScaleFactor:"screens/setScaleFactor"})),{},{changeActiveScreen(e,t,s){var i=this.getScreen(e);i&&(s||e!=this.activeScreenId)&&(this.$emit("beforeActiveScreenChange",this.activeScreenId,e),this.inTransition=!1,this.activeTransition=t||"none",this.oldActiveScreenId=this.activeScreenId,this.screenChangeTimeoutId&&clearTimeout(this.screenChangeTimeoutId),this.screenChangeTimeoutId=setTimeout(()=>{this.setActiveScreenId(e),"none"!==this.activeTransition&&(this.inTransition=!0,this.screenChangeAnimationTimeoutId&&clearTimeout(this.screenChangeAnimationTimeoutId),this.screenChangeAnimationTimeoutId=setTimeout(()=>{this.activeTransition="none",this.inTransition=!1},m)),this.$refs.activeScreenWrapper&&this.$refs.activeScreenWrapper.scrollTo({top:0,behavior:"auto"}),this.$emit("afterActiveScreenChange",this.oldActiveScreenId,this.activeScreenId)},"none"!==this.activeTransition?100:0))},onActiveScreenChange(){this.activeScreen&&(this.updateScaleFactor(),this.closeOverlayScreen(),this.refreshActiveScreenWrapperAlignment(),this.refreshDocumentTitle(),this.$refs.activeScreenWrapper&&this.$refs.activeScreenWrapper.focus(),document.body.classList.toggle("has-hotspots",this.activeScreenHotspots.length>0))},updateScaleFactor(){this.fitToScreen||0==this.activePrototype.scaleFactor?a["a"].loadImage(this.activeScreen.getImage()).then(e=>{e.success&&e.width>0&&setTimeout(()=>{this.$refs.activeScreen&&this.setScaleFactor(this.$refs.activeScreen.clientWidth/e.width)},0)}):this.setScaleFactor(this.activePrototype.scaleFactor)},goToPrevScreen(){this.orderedScreens[this.activeScreenOrderedIndex-1]&&this.setActiveScreenId(this.orderedScreens[this.activeScreenOrderedIndex-1].id)},goToNextScreen(){this.orderedScreens[this.activeScreenOrderedIndex+1]&&this.setActiveScreenId(this.orderedScreens[this.activeScreenOrderedIndex+1].id)},refreshActiveScreenWrapperAlignment(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.$nextTick(()=>{d&&clearTimeout(d),d=setTimeout(()=>{this.$refs.activeScreenWrapper&&(this.activeScreen.isLeftAligned?this.$refs.activeScreenWrapper.scrollLeft=0:this.activeScreen.isRightAligned?this.$refs.activeScreenWrapper.scrollLeft=this.$refs.activeScreenWrapper.scrollWidth:this.$refs.activeScreenWrapper.scrollLeft=(this.$refs.activeScreenWrapper.scrollWidth-this.$refs.activeScreenWrapper.offsetWidth)/2)},e)})},refreshDocumentTitle(){this.$setDocumentTitle(()=>this.$t("Screen")+" "+this.activeScreen.title)},hotspotNavigate(e){var t=this.getHotspot(e);if(t){var s=t.settings.transition||"none";"url"===t.type&&this.$getAppConfig("VUE_APP_ALLOW_HOTSPOTS_URL")<<0?window.open(t.settings.url||"#","_blank","noopener,noreferrer"):"prev"===t.type?this.orderedScreens[this.activeScreenOrderedIndex-1]&&this.changeActiveScreen(this.orderedScreens[this.activeScreenOrderedIndex-1].id,s):"next"===t.type?this.orderedScreens[this.activeScreenOrderedIndex+1]&&this.changeActiveScreen(this.orderedScreens[this.activeScreenOrderedIndex+1].id,s):"back"===t.type?this.overlayScreenId?this.closeOverlayScreen():this.oldActiveScreen&&this.changeActiveScreen(this.oldActiveScreen.id,s):"screen"===t.type?this.changeActiveScreen(t.settings.screenId,s):"overlay"===t.type?this.openOverlayScreen(t.settings.screenId,s,t.settings.outsideClose,t.settings.overlayPosition,t.settings.offsetTop,t.settings.offsetBottom,t.settings.offsetLeft,t.settings.offsetRight,t.settings.fixOverlay):"scroll"===t.type&&this.$refs.activeScreenWrapper&&this.$refs.activeScreenWrapper.scrollTo({behavior:"smooth",top:t.settings.scrollTop<<0,left:t.settings.scrollLeft<<0})}},fixedOverlayReposition(){this.isOverlayScreenFixed&&this.overlayScreenId&&this.$refs.activeScreenWrapper&&this.$refs.overlayContainer&&(this.$refs.overlayContainer.style.marginTop=this.$refs.activeScreenWrapper.scrollTop+"px",this.$refs.overlayContainer.style.marginLeft=this.$refs.activeScreenWrapper.scrollLeft+"px")},openOverlayScreen(e,t,s,i,r,o,n,c,l){e!=this.overlayScreenId&&this.closeOverlayScreen(()=>{this.isOverlayScreenClosing=!1,this.overlayScreenId=e,this.overlayScreenTransition=t||"none",this.overlayScreenPosition=i||"centered",this.overlayScreenOffsetTop=r<<0,this.overlayScreenOffsetBottom=o<<0,this.overlayScreenOffsetLeft=n<<0,this.overlayScreenOffsetRight=c<<0,this.overlayScreenOutsideClose=!!a["a"].isEmpty(s)||s,this.isOverlayScreenFixed=!a["a"].isEmpty(l)&&l,this.$nextTick(()=>{this.fixedOverlayReposition()})})},closeOverlayScreen(e){this.overlayScreenId?(this.isOverlayScreenClosing=!0,this.overlayCloseAnimationTimeoutId&&clearTimeout(this.overlayCloseAnimationTimeoutId),this.overlayCloseAnimationTimeoutId=setTimeout(()=>{this.isOverlayScreenClosing=!0,this.overlayScreenId=null,this.overlayScreenPosition="centered",this.overlayScreenTransition="none",this.overlayScreenOffsetTop=0,this.overlayScreenOffsetBottom=0,this.overlayScreenOffsetLeft=0,this.overlayScreenOffsetRight=0,this.overlayScreenOutsideClose=!0,a["a"].isFunction(e)&&e()},"none"!=this.overlayScreenTransition?m:0)):a["a"].isFunction(e)&&e()},onOverlayOutsideClick(e){this.overlayScreenId&&this.overlayScreenOutsideClose&&(e.preventDefault(),e.stopPropagation(),this.closeOverlayScreen())},onResize(){this.updateScaleFactor(),this.refreshActiveScreenWrapperAlignment()}})},v=h,p=s("2877"),u=Object(p["a"])(v,i,r,!1,null,null,null);t["a"]=u.exports},"097d":function(e,t,s){"use strict";var i=s("5ca1"),r=s("8378"),o=s("7726"),n=s("ebd6"),a=s("bcaa");i(i.P+i.R,"Promise",{finally:function(e){var t=n(this,r.Promise||o.Promise),s="function"==typeof e;return this.then(s?function(s){return a(t,e()).then((function(){return s}))}:e,s?function(s){return a(t,e()).then((function(){throw s}))}:e)}})},"35bb":function(e,t,s){"use strict";s("ac6a"),s("a481"),s("097d");var i=s("ade3"),r=s("2f62"),o=s("f744"),n=s("dd93"),a=s("46a0");function c(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function l(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?c(Object(s),!0).forEach((function(t){Object(i["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}t["a"]={data(){return{isLoadingComments:!1,showCommentsPanel:!1,mentionsList:[]}},computed:l(l(l({},Object(r["d"])({activePrototypeId:e=>e.prototypes.activePrototypeId,activeScreenId:e=>e.screens.activeScreenId,scaleFactor:e=>e.screens.scaleFactor,previewToken:e=>e.preview.previewToken,showResolvedComments:e=>e.comments.showResolvedComments,activeCommentId:e=>e.comments.activeCommentId,unreadComments:e=>e.notifications.unreadComments})),Object(r["c"])({getCommentsForScreen:"comments/getCommentsForScreen",activeComment:"comments/activeComment",getUnreadCommentsForScreen:"notifications/getUnreadCommentsForScreen",isCommentUnread:"notifications/isCommentUnread"})),{},{activeScreenComments(){return this.getCommentsForScreen(this.activeScreenId)},totalActiveScreenComments(){return this.activeScreenComments.length},activeScreenResolvedComments(){return this.getCommentsForScreen(this.activeScreenId,"resolved")},totalActiveScreenResolvedComments(){return this.activeScreenResolvedComments.length},activeScreenUnreadComments(){return this.getUnreadCommentsForScreen(this.activeScreenId)},totalActiveScreenUnreadComments(){return this.activeScreenUnreadComments.length},totalActiveScreenUnresolvedComments(){return this.totalActiveScreenComments-this.totalActiveScreenResolvedComments}}),watch:{activeScreenUnreadComments(e,t){for(let s in e)e[s].replyTo||this.addComment(e[s])},activeCommentId(e,t){this.updateQueryCommentIdParam(),this.activeComment&&this.activeComment.isResolved&&this.setShowResolvedComments(!0)}},methods:l(l({},Object(r["b"])({setComments:"comments/setComments",addComment:"comments/addComment",appendComments:"comments/appendComments",setShowResolvedComments:"comments/setShowResolvedComments",setActiveCommentId:"comments/setActiveCommentId"})),{},{convertCollaboratorsListToMentionsList(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e=e||[];var s=[];for(let i=e.length-1;i>=0;i--){if(t.indexOf(e[i].email)>=0)continue;let r=((e[i].firstName||"")+(e[i].lastName||"")).trim();s.push({value:e[i].email,label:r?r+" ("+e[i].email+")":e[i].email})}return s},loadComments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e=e||this.activePrototypeId,e&&!this.isLoadingComments){this.isLoadingComments=!0;var i=null;o["a"].enableAutoCancellation(!1),i=s?o["a"].Previews.getScreenCommentsList(this.previewToken,t,100,{envelope:!0,"search[prototypeId]":e,"search[replyTo]":0}):o["a"].ScreenComments.getList(t,100,{envelope:!0,"search[prototypeId]":e,"search[replyTo]":0}),i.finally(()=>{this.isLoadingComments=!1}).then(i=>{var r=n["a"].getNestedVal(i,"data.response",[]),o=n["a"].getNestedVal(i,"data.headers.x-pagination-current-page",1),a=n["a"].getNestedVal(i,"data.headers.x-pagination-page-count",1);1==t?this.setComments(r):this.appendComments(r),a>o&&this.loadComments(e,t+1,s),this.$route.query.commentId&&setTimeout(()=>{this.setActiveCommentId(this.$route.query.commentId)},300)}).catch(e=>{this.$errResponseHandler(e)})}},initCommentCreation(e,t){if(this.isInCommentsMode){this.deactivateComments();var s=new a["a"]({screenId:t||this.activeScreenId,left:this.scaleFactor>0?e.offsetX/this.scaleFactor:e.offsetX,top:this.scaleFactor>0?e.offsetY/this.scaleFactor:e.offsetY});this.addComment(s),this.setActiveCommentId(s.id)}},deactivateComments(){this.setActiveCommentId(null)},updateQueryCommentIdParam(){var e=Object.assign({},this.$route.query);this.activeComment&&!this.activeComment.isNew?e.commentId=this.activeComment.id:delete e.commentId,this.$router.replace({name:this.$route.name,params:Object.assign({},this.$route.params),query:e})},onCommentRepositioning(e,t){this.$refs.commentPopover&&this.$refs.commentPopover.reposition(t)}})}},"4d34":function(e,t,s){},"57d1":function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"sidebarPanel"},on:{"after-enter":e.triggerResize,"after-leave":e.triggerResize}},[e.isActive?t("aside",{staticClass:"app-sidebar-panel screen-comments-panel"},[t("header",{staticClass:"app-sidebar-section app-sidebar-header"},[t("h4",{staticClass:"title"},[e._v(e._s(e.$t("Screen comments")))]),t("div",{staticClass:"list-ctrls"},[t("div",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:e.$t("Close panel"),expression:"$t('Close panel')",modifiers:{left:!0}}],staticClass:"list-ctrl-item",on:{click:function(t){return t.preventDefault(),e.hide.apply(null,arguments)}}},[t("i",{staticClass:"fe fe-x"})])]),e.totalActiveScreenComments>0?t("div",{staticClass:"form-group form-group-switch m-t-20 m-b-5"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.resolvedCommentsToggle,expression:"resolvedCommentsToggle"}],attrs:{type:"checkbox",id:"show_resolved"},domProps:{checked:Array.isArray(e.resolvedCommentsToggle)?e._i(e.resolvedCommentsToggle,null)>-1:e.resolvedCommentsToggle},on:{change:function(t){var s=e.resolvedCommentsToggle,i=t.target,r=!!i.checked;if(Array.isArray(s)){var o=null,n=e._i(s,o);i.checked?n<0&&(e.resolvedCommentsToggle=s.concat([o])):n>-1&&(e.resolvedCommentsToggle=s.slice(0,n).concat(s.slice(n+1)))}else e.resolvedCommentsToggle=r}}}),t("label",{attrs:{for:"show_resolved"}},[e._v(e._s(e.$t("Show resolved comments ({count})",{count:e.totalActiveScreenResolvedComments})))])]):e._e()]),t("div",{staticClass:"app-sidebar-section app-sidebar-content"},[e.totalActiveScreenComments<=0?t("div",{staticClass:"placeholder-block"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fe fe-message-circle"})]),t("div",{staticClass:"content"},[e._v(e._s(e.$t("The screen doesn't have any comments yet.")))])]):!e.showResolvedComments&&e.totalActiveScreenComments>0&&!e.hasUnresolvedComments?t("div",{staticClass:"placeholder-block"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fe fe-message-circle"})]),t("div",{staticClass:"content"},[e._v(e._s(e.$t("All screen comments have been resolved.")))])]):t("div",{staticClass:"cards-list"},[e._l(e.activeScreenComments,(function(s,i){return[s.isNew||s.isResolved&&!e.showResolvedComments?e._e():t("div",{key:"cp_"+s.id+i,staticClass:"card comment-card",class:{active:e.activeCommentId==s.id,"card-danger":e.isCommentUnread(s.id)},on:{click:function(t){return t.preventDefault(),e.setActiveCommentId(s.id)}}},[t("figure",{staticClass:"icon"},[t("span",{staticClass:"txt txt-hint"},[e._v(e._s(e.totalActiveScreenComments-i))]),s.isResolved?t("i",{staticClass:"fe fe-check txt-success"}):e._e()]),t("div",{staticClass:"content"},[t("div",{staticClass:"meta"},[t("div",{staticClass:"meta-item"},[e._v(e._s(s.user?s.user.identifier:s.from))]),t("div",{staticClass:"meta-item",attrs:{title:s.createdAtLocal}},[e._v(" "+e._s(s.createdAtFromNow)+" ")])]),t("div",{staticClass:"title txt-default"},[e._v(e._s(s.message))])])])]}))],2)])]):e._e()])},r=[],o=(s("ac6a"),s("ade3")),n=s("2f62");function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var l={name:"comments-panel",data(){return{isActive:!1}},computed:c(c(c({},Object(n["d"])({activePrototypeId:e=>e.prototypes.activePrototypeId,activeScreenId:e=>e.screens.activeScreenId,showResolvedComments:e=>e.comments.showResolvedComments,activeCommentId:e=>e.comments.activeCommentId,unreadComments:e=>e.notifications.unreadComments})),Object(n["c"])({getCommentsForScreen:"comments/getCommentsForScreen",isCommentUnread:"notifications/isCommentUnread"})),{},{activeScreenComments(){return this.getCommentsForScreen(this.activeScreenId).reverse()},activeScreenResolvedComments(){return this.getCommentsForScreen(this.activeScreenId,"resolved").reverse()},totalActiveScreenComments(){return this.activeScreenComments.length},totalActiveScreenResolvedComments(){return this.activeScreenResolvedComments.length},hasUnresolvedComments(){return this.totalActiveScreenResolvedComments<this.totalActiveScreenComments},resolvedCommentsToggle:{get(){return this.showResolvedComments},set(e){this.setShowResolvedComments(e)}}}),methods:c(c({},Object(n["b"])({setShowResolvedComments:"comments/setShowResolvedComments",setActiveCommentId:"comments/setActiveCommentId"})),{},{hide(){this.isActive=!1},show(){this.isActive=!0},toggle(){this.isActive?this.hide():this.show()},triggerResize(){window.dispatchEvent(new Event("resize"))}})},m=l,d=(s("c014"),s("2877")),h=Object(d["a"])(m,i,r,!1,null,"0802bf0d",null);t["a"]=h.exports},"7bbf":function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("dragger",{staticClass:"comment-pin",class:{new:e.comment.isNew,completed:e.comment.isResolved,active:e.isActive,loader:e.isProcessing},style:{left:e.comment.left*e.scaleFactor+"px",top:e.comment.top*e.scaleFactor+"px"},attrs:{"data-id":e.comment.id,enable:e.allowPositionChange,wrapperSelector:".screen-inner-wrapper"},on:{dragging:function(t){return e.onRepositioning()},dragStopped:function(t){return e.updatePinPosition()}},nativeOn:{click:function(t){return t.preventDefault(),e.setActiveCommentId(e.comment.id)}}})},r=[],o=(s("ac6a"),s("097d"),s("ade3")),n=s("2f62"),a=s("f744"),c=s("82bb"),l=s("46a0");function m(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function d(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?m(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var h={name:"comment-pin",components:{dragger:c["a"]},props:{allowPositionChange:{type:Boolean,default:!1},comment:{type:l["a"],required:!0}},data(){return{isProcessing:!1}},watch:{activeCommentId(e,t){this.comment.id==e?this.onActivate():this.onDeactivate()}},computed:d(d({},Object(n["d"])({scaleFactor:e=>e.screens.scaleFactor,activeCommentId:e=>e.comments.activeCommentId})),{},{isActive(){return this.comment.id==this.activeCommentId}}),methods:d(d({},Object(n["b"])({removeComment:"comments/removeComment",setActiveCommentId:"comments/setActiveCommentId"})),{},{onActivate(){this.$nextTick(()=>{this.positionWithinView()})},onDeactivate(){this.comment.isNew&&this.removeComment(this.comment.id)},positionWithinView(){this.$el.scrollIntoView({block:"nearest"})},updatePinPosition(){this.comment.left=this.$el.offsetLeft/this.scaleFactor,this.comment.top=this.$el.offsetTop/this.scaleFactor,this.comment.isNew||(this.isProcessing=!0,a["a"].ScreenComments.update(this.comment.id,{left:this.comment.left,top:this.comment.top}).then(e=>{this.comment.load(e.data),this.$emit("commentUpdated",this.comment,this.$el)}).catch(e=>{this.$errResponseHandler(e)}).finally(()=>{this.isProcessing=!1}))},onRepositioning(){this.$emit("repositioning",this.comment,this.$el)}})},v=h,p=s("2877"),u=Object(p["a"])(v,i,r,!1,null,null,null);t["a"]=u.exports},"82bb":function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:e.dragInit.apply(null,arguments)},touchstart:e.dragInit}},[e._t("default")],2)},r=[],o={name:"dragger",props:{wrapperSelector:{type:String},tolerance:{type:Number,default:10},enable:{type:Boolean,default:!0}},data(){return{startX:0,startY:0,shiftX:0,shiftY:0,lockX:!1,lockY:!1,dragStarted:!1}},computed:{wrapper(){return this.$el.closest(this.wrapperSelector)||this.$el.parentNode}},methods:{dragInit(e){this.enable&&(e.stopPropagation(),this.startX=e.clientX,this.startY=e.clientY,this.shiftX=e.clientX-this.$el.offsetLeft,this.shiftY=e.clientY-this.$el.offsetTop,document.addEventListener("touchmove",this.onMove),document.addEventListener("mousemove",this.onMove),document.addEventListener("touchend",this.onDrop),document.addEventListener("mouseup",this.onDrop))},onMove(e){let t=e.clientX-this.startX,s=e.clientY-this.startY,i=e.clientX-this.shiftX,r=e.clientY-this.shiftY;if(!(!this.dragStarted&&Math.abs(i-this.$el.offsetLeft)<this.tolerance&&Math.abs(r-this.$el.offsetTop)<this.tolerance)){if(e.preventDefault(),this.dragStarted||(this.dragStarted=!0,this.$el.classList.add("no-pointer-events"),this.wrapper.classList.add("dragging"),this.$emit("dragStarted",e)),this.$emit("dragging",e),e.shiftKey?this.lockX||this.lockY||(Math.abs(t)>Math.abs(s)?(this.lockX=!1,this.lockY=!0):(this.lockX=!0,this.lockY=!1)):(this.lockX=!1,this.lockY=!1),!this.lockX){let e=this.wrapper.scrollWidth||this.wrapper.offsetWidth;i+this.$el.offsetWidth>e&&(i=e-this.$el.offsetWidth),i=i<0?0:i,this.$el.style.left=i+"px"}if(!this.lockY){let e=this.wrapper.scrollHeight||this.wrapper.offsetHeight;r+this.$el.offsetHeight>e&&(r=e-this.$el.offsetHeight),r=r<0?0:r,this.$el.style.top=r+"px"}}},onDrop(e){this.dragStarted&&(e.preventDefault(),this.dragStarted=!1,this.lockX=!1,this.lockY=!1,this.$el.classList.remove("no-pointer-events"),this.wrapper.classList.remove("dragging"),this.$emit("dragStopped",e)),document.removeEventListener("touchmove",this.onMove),document.removeEventListener("mousemove",this.onMove),document.removeEventListener("touchend",this.onDrop),document.removeEventListener("mouseup",this.onDrop)}}},n=o,a=s("2877"),c=Object(a["a"])(n,i,r,!1,null,null,null);t["a"]=c.exports},"917d":function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"popover-holder comment-popover-holder"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isActive,expression:"isActive"}],staticClass:"popover-overlay",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.close()}}}),t("div",{ref:"popover",staticClass:"popover comment-popover",class:{active:e.isActive}},[e.lastActiveComment.isNew?e._e():t("div",{staticClass:"form-group resolved-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.lastActiveComment.status,expression:"lastActiveComment.status"}],attrs:{type:"checkbox",id:"mark_as_resoved_"+e.lastActiveComment.id,"true-value":"resolved","false-value":"pending"},domProps:{checked:Array.isArray(e.lastActiveComment.status)?e._i(e.lastActiveComment.status,null)>-1:e._q(e.lastActiveComment.status,"resolved")},on:{change:[function(t){var s=e.lastActiveComment.status,i=t.target,r=i.checked?"resolved":"pending";if(Array.isArray(s)){var o=null,n=e._i(s,o);i.checked?n<0&&e.$set(e.lastActiveComment,"status",s.concat([o])):n>-1&&e.$set(e.lastActiveComment,"status",s.slice(0,n).concat(s.slice(n+1)))}else e.$set(e.lastActiveComment,"status",r)},function(t){return e.saveCommentStatus()}]}}),t("label",{attrs:{for:"mark_as_resoved_"+e.lastActiveComment.id}},[e._v(e._s(e.$t("Mark as resolved")))])]),e.isLoadingReplies?t("div",{staticClass:"block txt-center txt-hint p-small"},[t("span",{staticClass:"loader"})]):e._e(),e.isLoadingReplies||e.lastActiveComment.isNew?e._e():t("div",{ref:"commentsListContainer",staticClass:"comments-list"},e._l(e.commentsList,(function(s){return t("div",{key:"reply_"+s.id,staticClass:"comment-list-item",class:{primary:s.isPrimary}},[t("figure",{staticClass:"avatar"},[s.user&&s.user.getAvatar("small")?t("img",{attrs:{src:s.user.getAvatar("small"),alt:"User avatar"}}):t("i",{staticClass:"fe fe-user"})]),t("div",{staticClass:"content"},[t("small",{staticClass:"content-header"},[t("span",{staticClass:"name"},[e._v(e._s(s.user?s.user.identifier:s.from))]),t("span",{staticClass:"date txt-hint",attrs:{title:s.createdAtLocal}},[e._v(" "+e._s(s.createdAtFromNow)+" ")])]),t("div",{staticClass:"message"},[e._v(e._s(s.message))])]),t("div",{staticClass:"list-ctrls"},[e.isForPreview?e._e():t("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:e.$t("Delete"),expression:"$t('Delete')",modifiers:{top:!0}}],staticClass:"list-ctrl-item ctrl-danger",on:{click:function(t){return t.preventDefault(),e.deleteComment(s.id)}}},[t("i",{staticClass:"fe fe-trash"})])])])})),0),t("form",{ref:"messageForm",staticClass:"comment-message-form",on:{submit:function(e){e.preventDefault()}}},[e.isForPreview?t("form-field",{staticClass:"email-field",attrs:{name:"from",showErrorMsg:!0}},[t("div",{staticClass:"input-group"},[t("div",{staticClass:"input-addon p-l-small p-r-0 m-r-0"},[t("i",{directives:[{name:"tooltip",rawName:"v-tooltip.left",value:e.$t("From (email)"),expression:"$t('From (email)')",modifiers:{left:!0}}],staticClass:"fe fe-mail"})]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.from,expression:"from"}],staticClass:"p-l-10",attrs:{type:"email",required:"",placeholder:e.$t("Your email")},domProps:{value:e.from},on:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault()},input:function(t){t.target.composing||(e.from=t.target.value)}}})])]):e._e(),t("form-field",{staticClass:"message-field",attrs:{name:"message",showErrorMsg:!1}},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],ref:"messageField",attrs:{required:"",placeholder:e.$t("Write a comment (@ to mention)")},domProps:{value:e.message},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.addComment()):null},input:function(t){t.target.composing||(e.message=t.target.value)}}}),t("div",{staticClass:"ctrls-bar"},[t("button",{staticClass:"ctrl-item emoji-ctrl",attrs:{type:"button"}},[t("i",{staticClass:"fe fe-smile"}),t("toggler",{ref:"emojisBar",staticClass:"emojis-bar"},[t("span",{staticClass:"emoji",attrs:{title:"+1"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("👍")}}},[e._v("👍")]),t("span",{staticClass:"emoji",attrs:{title:"-1"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("👎")}}},[e._v("👎")]),t("span",{staticClass:"emoji",attrs:{title:"ok"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("👌")}}},[e._v("👌")]),t("span",{staticClass:"emoji",attrs:{title:"pray"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("🙏")}}},[e._v("🙏")]),t("span",{staticClass:"emoji",attrs:{title:"smile"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("🙂")}}},[e._v("🙂")]),t("span",{staticClass:"emoji",attrs:{title:"confused"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("😕")}}},[e._v("😕")]),t("span",{staticClass:"emoji",attrs:{title:"thinking"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("🤔")}}},[e._v("🤔")]),t("span",{staticClass:"emoji",attrs:{title:"joy"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("😂")}}},[e._v("😂")]),t("span",{staticClass:"emoji",attrs:{title:"hooray"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("🎉")}}},[e._v("🎉")]),t("span",{staticClass:"emoji",attrs:{title:"watching"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("👀")}}},[e._v("👀")]),t("span",{staticClass:"emoji",attrs:{title:"love"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("❤️")}}},[e._v("❤️")]),t("span",{staticClass:"emoji",attrs:{title:"poop"},on:{click:function(t){return t.preventDefault(),e.insertEmoji("💩")}}},[e._v("💩")])])],1),t("button",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:e.$t("Add comment ({shortcut})",{shortcut:"Ctrl+Enter"}),expression:"$t('Add comment ({shortcut})', {shortcut: 'Ctrl+Enter'})",modifiers:{bottom:!0}}],ref:"messageBtn",staticClass:"ctrl-item submit-ctrl",attrs:{type:"button"},on:{click:function(t){return t.preventDefault(),e.addComment()},keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.addComment()):null}}},[e.isProcessing?t("span",{staticClass:"loader"}):t("i",{staticClass:"fe fe-send"})])]),t("mentions-list",{ref:"mentionsList",staticClass:"dropdown-compact input-dropdown",attrs:{list:e.mentionsList}})],1)],1)])])},r=[],o=(s("ac6a"),s("097d"),s("55dd"),s("ade3")),n=s("2f62"),a=s("0abc"),c=s("3d48"),l=s("dd93"),m=s("f744"),d=s("46a0"),h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"dropdown",class:{active:e.isActive}},[e._l(e.filteredList,(function(s,i){return[t("div",{ref:"mentions",refInFor:!0,staticClass:"dropdown-item",class:{highlight:e.focusIndex==i},on:{click:function(t){return t.preventDefault(),e.select(i)}}},[e._v(e._s(s.label))]),i+1!=e.filteredList.length?t("hr"):e._e()]}))],2)},v=[],p=(s("a481"),{name:"mentions-list",props:{list:{type:Array,required:!0},triggers:{type:Array,default(){return["+","@"]}},input:{}},data(){return{isActive:!1,focusIndex:0,filteredList:[]}},computed:{inputElem(){return this.input instanceof Node?this.input:this.input&&l["a"].isString(this.input)&&document.querySelector(this.input)?document.querySelector(this.input):this.$el.parentNode.querySelector("textarea, input")}},mounted(){this.inputElem?(this.inputElem.addEventListener("input",this.onInputChange),this.inputElem.addEventListener("keydown",this.onInputKeydown)):console.warn("MentionsList: input element is invalid or missing.")},beforeDestroy(){this.inputElem&&(this.inputElem.removeEventListener("input",this.onInputChange),this.inputElem.removeEventListener("keydown",this.onInputKeydown))},methods:{hide(){this.isActive&&(this.isActive=!1,this.focusIndex=0,this.filteredList=[],this.$emit("hide"))},show(){this.isActive||(this.isActive=!0,this.focusIndex=0,this.$emit("show"),this.positionFocusedMendtionWithinView())},focusPrev(){this.focusIndex<=0?this.focusIndex=this.filteredList.length-1:this.focusIndex--,this.positionFocusedMendtionWithinView()},focusNext(){this.focusIndex>=this.filteredList.length-1?this.focusIndex=0:this.focusIndex++,this.positionFocusedMendtionWithinView()},positionFocusedMendtionWithinView(){this.$refs.mentions&&this.$refs.mentions[this.focusIndex]&&this.$refs.mentions[this.focusIndex].scrollIntoView({block:"nearest"})},getCurrentWordInfo(){var e="undefined"!==typeof this.inputElem.selectionStart?this.inputElem.selectionStart:this.inputElem.value.length,t=l["a"].getWordInfoAt(this.inputElem.value,e-1);return t},select(e){e="undefined"!==typeof e?e:this.focusIndex;var t=this.getCurrentWordInfo();if(t.word&&this.inputElem&&this.filteredList[e]){var s=this.inputElem.value;this.inputElem.value=s.substring(0,t.start)+this.triggers[0]+this.filteredList[e].value+s.substring(t.end+1)+" ",this.inputElem.dispatchEvent(new Event("input")),this.$nextTick(()=>{this.inputElem.focus(),this.hide()})}},filterList(e){if(e=(e||"").toLowerCase().replace(/\s+/g,""),!e)return this.list;var t=[];for(let s=this.list.length-1;s>=0;s--){let i=(this.list[s].value+this.list[s].label||"").toLowerCase().replace(/\s+/g,"");i.indexOf(e)>=0&&t.push(this.list[s])}return t},onInputChange(e){var t=this.getCurrentWordInfo();this.hide(),t.word&&this.triggers.indexOf(t.word[0])>=0&&(this.filteredList=this.filterList(t.word.substring(1)),this.filteredList.length&&this.show())},onInputKeydown(e){if(this.isActive){var t=e.which||e.keyCode;13==t?(e.preventDefault(),this.select()):38==t?(e.preventDefault(),this.focusPrev()):40==t&&(e.preventDefault(),this.focusNext())}}}}),u=p,f=s("2877"),g=Object(f["a"])(u,h,v,!1,null,null,null),C=g.exports;function y(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function S(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?y(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):y(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var b={name:"active-comment-popover",components:{"mentions-list":C},props:{mentionsList:{type:Array,default(){return[]}},isForPreview:{type:Boolean,default:!0}},data(){return{isProcessing:!1,isLoadingReplies:!1,lastActiveComment:new d["a"],replies:[],message:"",from:""}},computed:S(S(S({},Object(n["d"])({previewToken:e=>e.preview.previewToken,activeCommentId:e=>e.comments.activeCommentId})),Object(n["c"])({activeComment:"comments/activeComment",getUnreadComment:"notifications/getUnreadComment",getUnreadCommentsForComment:"notifications/getUnreadCommentsForComment"})),{},{isActive(){return null!=this.activeComment},commentsList(){var e=this.replies.slice();return this.lastActiveComment&&!this.lastActiveComment.isNew&&e.unshift(this.lastActiveComment),e.sort((e,t)=>Date.parse(e["createdAt"])-Date.parse(t["createdAt"])),e},unreadCommentReplies(){return this.getUnreadCommentsForComment(this.activeCommentId)}}),watch:{commentsList(e,t){this.$nextTick(()=>{setTimeout(()=>{this.reposition()},100)})},unreadCommentReplies(e,t){if(e){for(let t in e)l["a"].pushUnique(this.replies,e[t]);e.length&&this.isActive&&this.$nextTick(()=>{this.scrollToLastComment(),this.readComments(this.commentsList.slice(),500)})}},activeCommentId(e,t){this.activeComment?this.open():this.close()}},mounted(){document.addEventListener("scroll",this.onEventPopoverReposition,{capture:!0,passive:!0}),window.addEventListener("resize",this.onEventPopoverReposition,{passive:!0}),this.from=c["a"].getItem(a["a"].get("VUE_APP_PREVIEW_COMMENT_FROM_STORAGE_KEY"))||l["a"].getNestedVal(this.$store,"state.user.user.email","")},beforeDestroy(){document.removeEventListener("scroll",this.onEventPopoverReposition,{capture:!0}),window.removeEventListener("resize",this.onEventPopoverReposition)},methods:S(S({},Object(n["b"])({setActiveCommentId:"comments/setActiveCommentId",removeComment:"comments/removeComment",removeUnreadComment:"notifications/removeUnreadComment",markAsRead:"notifications/markAsRead"})),{},{initForm(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&(this.message=""),this.$refs.messageBtn&&this.$refs.messageBtn.blur()},open(){this.lastActiveComment=this.activeComment,this.replies=[],this.initForm(),this.loadReplies(),this.$nextTick(()=>this.reposition()),this.lastActiveComment.isNew&&this.$refs.messageField&&setTimeout(()=>{this.$refs.messageField&&this.$refs.messageField.focus()},100)},close(){this.setActiveCommentId(null),this.lastActiveComment.isNew&&this.removeComment(this.lastActiveComment.id),this.$refs.mentionsList&&this.$refs.mentionsList.hide(),this.$refs.emojisBar&&this.$refs.emojisBar.hide()},onEventPopoverReposition(e){this.isActive&&this.reposition()},reposition(e){if(e=e||document.querySelector('.comment-pin[data-id="'+this.lastActiveComment.id+'"]'),this.isActive&&e){var t=document.querySelector(".preview-container")||document.documentElement,s=this.$refs.popover,i=e.getBoundingClientRect(),r=5,o=i.top-r,n=i.left+i.width+r;s.style.left="0px",s.style.top="0px",n+s.offsetWidth>t.clientWidth&&(n=i.left-s.offsetWidth-r),n=n>=0?n:0,o+s.offsetHeight>t.clientHeight&&(o=t.clientHeight-s.offsetHeight),o=o>=0?o:0,s.style.left=n+"px",s.style.top=o+"px"}},loadReplies(){var e;this.isLoadingReplies||this.lastActiveComment.isNew||(this.isLoadingReplies=!0,m["a"].enableAutoCancellation(!1),e=this.isForPreview?m["a"].Previews.getScreenCommentsList(this.previewToken,1,199,{"search[screenId]":this.lastActiveComment.screenId,"search[replyTo]":this.lastActiveComment.id}):m["a"].ScreenComments.getList(1,199,{"search[screenId]":this.lastActiveComment.screenId,"search[replyTo]":this.lastActiveComment.id}),e.then(e=>{this.replies=d["a"].createInstances(e.data),this.readComments(this.commentsList.slice())}).catch(e=>{this.$errResponseHandler(e)}).finally(()=>{this.isLoadingReplies=!1,this.$nextTick(()=>{this.scrollToLastComment()})}))},deleteComment(e){if(!this.isForPreview){var t=l["a"].findByKey(this.commentsList,"id",e);if(t){var s="";s=t.isPrimary?this.$t("Do you really want to delete the selected comment and all its replies?"):this.$t("Do you really want to delete the selected comment?"),window.confirm(s)&&(this.$toast(this.$t("Successfully deleted comment.")),l["a"].removeByKey(this.replies,"id",e),this.removeComment(e),this.lastActiveComment.id==e&&this.close(),m["a"].ScreenComments.delete(e))}}},addComment(){if(!this.isProcessing&&this.message){var e;this.isProcessing=!0;var t=this.lastActiveComment.isNew?null:this.lastActiveComment.id;e=this.isForPreview?m["a"].Previews.createScreenComment(this.previewToken,{replyTo:t,screenId:this.lastActiveComment.screenId,left:this.lastActiveComment.left,top:this.lastActiveComment.top,message:this.message,from:this.from}):m["a"].ScreenComments.create({replyTo:t,screenId:this.lastActiveComment.screenId,left:this.lastActiveComment.left,top:this.lastActiveComment.top,message:this.message}),e.then(e=>{c["a"].setItem(a["a"].get("VUE_APP_PREVIEW_COMMENT_FROM_STORAGE_KEY"),this.from),this.initForm(!0);var s=t?new d["a"]:this.lastActiveComment;s.load(e.data),s.isReply?(this.replies.push(s),this.$nextTick(()=>{this.scrollToLastComment()})):this.close(),this.$emit("commentCreated",s)}).catch(e=>{this.$errResponseHandler(e)}).finally(()=>{this.isProcessing=!1})}else this.$refs.messageForm&&l["a"].isFunction(this.$refs.messageForm.reportValidity)&&this.$refs.messageForm.reportValidity()},saveCommentStatus(){var e;this.isProcessing||this.lastActiveComment.isNew||(this.isProcessing=!0,e=this.isForPreview?m["a"].Previews.updateScreenComment(this.previewToken,this.lastActiveComment.id,{status:this.lastActiveComment.status}):m["a"].ScreenComments.update(this.lastActiveComment.id,{status:this.lastActiveComment.status}),e.then(e=>{this.lastActiveComment.load(e.data),this.lastActiveComment.isResolved&&this.close(),this.$emit("commentUpdated",this.lastActiveComment)}).catch(e=>{this.$errResponseHandler(e)}).finally(()=>{this.isProcessing=!1}))},scrollToLastComment(){this.$refs.popover&&this.$refs.popover.scrollTo({behavior:"smooth",top:this.$refs.popover.scrollHeight})},readComments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;setTimeout(()=>{for(let t=e.length-1;t>=0;t--)this.getUnreadComment(e[t].id)&&(this.previewToken?this.removeUnreadComment(e[t].id):this.markAsRead(e[t].id))},t)},insertEmoji(e){l["a"].isEmpty(this.message)||(this.message=this.message.trim()+" "),this.message+=e+" ",this.$nextTick(()=>{this.$refs.messageField&&this.$refs.messageField.focus()})}})},w=b,O=Object(f["a"])(w,i,r,!1,null,null,null);t["a"]=O.exports},"9aaf":function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"previewPanel"}},[e.isActive&&e.screens.length?t("div",{staticClass:"preview-screens-panel",on:{"&!wheel":function(t){return e.verticalToHorizontalScroll.apply(null,arguments)}}},[t("div",{staticClass:"thumbs-list"},e._l(e.orderedScreens,(function(s){return t("figure",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:s.title,expression:"screen.title",modifiers:{top:!0}}],key:"thumb_"+s.id,staticClass:"thumb thumb-handle screen-thumb",class:{active:e.activeScreenId==s.id},on:{click:function(t){return t.preventDefault(),e.setActiveScreenId(s.id)}}},[s.getImage("small")&&!e.brokenThumbs[s.id]?t("img",{staticClass:"img",attrs:{src:s.getImage("small"),alt:s.title},on:{error:function(t){return e.$set(e.brokenThumbs,s.id,!0)}}}):t("i",{staticClass:"fe fe-image img"})])})),0)]):e._e()])},r=[],o=(s("ac6a"),s("ade3")),n=s("2f62");function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var l={name:"screens-panel",data(){return{isActive:!1,brokenThumbs:{}}},computed:c(c({},Object(n["d"])({screens:e=>e.screens.screens,activeScreenId:e=>e.screens.activeScreenId})),Object(n["c"])({orderedScreens:"screens/orderedScreens"})),watch:{activeScreenId(e,t){e!==t&&this.isActive&&this.scrollToActiveScreenThumb()}},methods:c(c({},Object(n["b"])({setActiveScreenId:"screens/setActiveScreenId"})),{},{show(){this.isActive=!0,this.scrollToActiveScreenThumb()},hide(){this.isActive=!1},toggle(){this.isActive?this.hide():this.show()},scrollToActiveScreenThumb(){this.$nextTick(()=>{if(this.isActive&&this.$el){var e=15,t=this.$el,s=t?t.querySelector(".screen-thumb.active"):null;if(s){var i=s.offsetLeft,r=i+s.offsetWidth,o=t.scrollLeft,n=o+t.offsetWidth;i-e<o?t.scrollLeft=i-e:r+e>n&&(t.scrollLeft=o-(n-(r+e)))}}})},verticalToHorizontalScroll(e){if("wheel"==e.type&&this.$el){var t=(e.deltaY||-e.wheelDelta||e.detail)>>10||1;t*=-300,this.$el.scrollLeft-=t}}})},m=l,d=s("2877"),h=Object(d["a"])(m,i,r,!1,null,null,null);t["a"]=h.exports},a5b8:function(e,t,s){"use strict";var i=s("d8e8");function r(e){var t,s;this.promise=new e((function(e,i){if(void 0!==t||void 0!==s)throw TypeError("Bad Promise constructor");t=e,s=i})),this.resolve=i(t),this.reject=i(s)}e.exports.f=function(e){return new r(e)}},bcaa:function(e,t,s){var i=s("cb7c"),r=s("d3f4"),o=s("a5b8");e.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var s=o.f(e),n=s.resolve;return n(t),s.promise}},c014:function(e,t,s){"use strict";s("4d34")},c647:function(e,t,s){"use strict";s("ac6a"),s("a481"),s("097d");var i=s("ade3"),r=s("2f62"),o=s("f744"),n=s("dd93"),a=s("0abc"),c=s("3d48");s("49cb");function l(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function m(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?l(Object(s),!0).forEach((function(t){Object(i["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}t["a"]={data(){return{isPreviewModeHintsActive:!1,isLoadingHotspots:!1,isLoadingHotspotTemplates:!1,fitToScreen:!1,keepHotspotsVisible:!1}},computed:m(m({},Object(r["d"])({activePrototypeId:e=>e.prototypes.activePrototypeId,hotspots:e=>e.hotspots.hotspots,hotspotTemplates:e=>e.hotspots.hotspotTemplates})),Object(r["c"])({getHotspot:"hotspots/getHotspot",getHotspotTemplate:"hotspots/getHotspotTemplate",getHotspotsForScreen:"hotspots/getHotspotsForScreen"})),watch:{fitToScreen:function(e){c["a"].setItem(a["a"].get("VUE_APP_TOGGLE_FIT_TO_SCREEN_STORAGE_KEY"),e)}},mounted(){this.keepHotspotsVisible=1==this.$route.query.hotspots,"undefined"!==typeof this.$route.query.fit?this.fitToScreen=1==this.$route.query.fit:this.fitToScreen=c["a"].getItem(a["a"].get("VUE_APP_TOGGLE_FIT_TO_SCREEN_STORAGE_KEY"),!1)},methods:m(m({},Object(r["b"])({setHotspots:"hotspots/setHotspots",appendHotspots:"hotspots/appendHotspots",setHotspotTemplates:"hotspots/setHotspotTemplates"})),{},{loadHotspots(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e=e||this.activePrototypeId,e&&!this.isLoadingHotspots&&(this.isLoadingHotspots=!0,o["a"].Hotspots.getList(t,200,{envelope:!0,"search[prototypeId]":e}).finally(()=>{this.isLoadingHotspots=!1}).then(s=>{var i=n["a"].getNestedVal(s,"data.response",[]),r=n["a"].getNestedVal(s,"data.headers.x-pagination-current-page",1),o=n["a"].getNestedVal(s,"data.headers.x-pagination-page-count",1);1==t?this.setHotspots(i):this.appendHotspots(i),o>r&&this.loadHotspots(e,t+1)}).catch(e=>{this.$errResponseHandler(e)}))},loadHotspotTemplates(e){e=e||this.activePrototypeId,e&&!this.isLoadingHotspotTemplates&&(this.isLoadingHotspotTemplates=!0,o["a"].HotspotTemplates.getList(1,100,{expand:"screenIds","search[prototypeId]":e}).then(e=>{this.setHotspotTemplates(e.data||[])}).catch(e=>{this.$errResponseHandler(e)}).finally(()=>{this.isLoadingHotspotTemplates=!1}))},blinkPreviewModeHints(){this.isPreviewModeHintsActive=!0,this.previewModeHintsTimeoutId&&clearTimeout(this.previewModeHintsTimeoutId),this.previewModeHintsTimeoutId=setTimeout(()=>{this.isPreviewModeHintsActive=!1},500)},toggleFitToScreen(){this.fitToScreen=!this.fitToScreen,this.$router.replace({name:this.$route.name,params:Object.assign({},this.$route.params),query:Object.assign({},this.$route.query,{fit:this.fitToScreen?"1":"0"})})},toggleKeepHotspotsVisible(){this.keepHotspotsVisible=!this.keepHotspotsVisible,this.$router.replace({name:this.$route.name,params:Object.assign({},this.$route.params),query:Object.assign({},this.$route.query,{hotspots:this.keepHotspotsVisible?"1":"0"})})}})}}}]);